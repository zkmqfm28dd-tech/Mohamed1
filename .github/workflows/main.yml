name: Build Tweak

on:
  workflow_dispatch:

jobs:
  build:
    runs-on: macos-latest

    steps:
      - name: Checkout tweak repository
        uses: actions/checkout@v4
      
      - name: Checkout Theos
        uses: actions/checkout@v4
        with:
          repository: theos/theos
          path: theos
          submodules: recursive
      
      - name: Setup THEOS env
        run: |
          echo "THEOS=$GITHUB_WORKSPACE/theos" >> $GITHUB_ENV
          echo "$GITHUB_WORKSPACE/theos/bin" >> $GITHUB_PATH

      - name: Build
        run: |
          # حذف مجلد SDK القديم
          rm -rf "$THEOS/sdks"
          
          # استخدام SDK أحدث (iOS 16.4)
          git clone --depth=1 https://github.com/xybp888/iOS-SDKs "$THEOS/sdks"
          mv "$THEOS/sdks/iPhoneOS16.4.sdk" "$THEOS/sdks/iPhoneOS.sdk"
          
          # تأكد من وجود UIKit
          echo "Checking SDK structure:"
          ls -la "$THEOS/sdks/iPhoneOS.sdk/System/Library/Frameworks/" | grep UIKit || echo "UIKit not found!"
          
          # البناء
          make package FINALPACKAGE=1
          
      - name: Upload Artifact
        uses: actions/upload-artifact@v4
        with:
          name: AIProMenu_DEB
          path: packages/*.deb
